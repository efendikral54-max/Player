<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal IPTV Player</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        video { width: 100%; height: 100%; object-fit: contain; }
        #msg { position: absolute; z-index: 10; color: white; font-family: sans-serif; background: rgba(0,0,0,0.6); padding: 20px; border-radius: 10px; text-align: center; font-weight: bold; }
    </style>
</head>
<body>
    <div id="msg">Yükleniyor...</div>
    <video id="video" playsinline autoplay></video>

    <script>
        const video = document.getElementById('video');
        const msg = document.getElementById('msg');
        let hasInteracted = false;

        function startStream(url) {
            if (!url || url.length < 10) return;
            msg.innerHTML = "Bağlanıyor...";
            
            // Wir nutzen hier KEIN hls.js für goldvod/workers, 
            // da die Server hls.js oft blockieren (CORS).
            // Wir lassen das Android-System (Native) die Arbeit machen.
            video.src = url;
            video.load();
            
            video.play().then(() => {
                if(hasInteracted) {
                    msg.style.display = 'none';
                    video.muted = false;
                } else {
                    msg.innerHTML = "SES İÇİN OK TUŞUNA BAS";
                }
            }).catch(() => {
                msg.innerHTML = "SES İÇİN OK TUŞUNA BAS";
            });
        }

        // Interaktion für Sound
        const unlock = () => {
            hasInteracted = true;
            video.muted = false;
            video.play();
            msg.style.display = 'none';
        };
        window.addEventListener('click', unlock);
        window.addEventListener('keydown', unlock);

        // Kodular Kommunikation
        setInterval(() => {
            let url = window.AppInventor.getWebViewString();
            if (url && url !== video.src && url.startsWith('http')) {
                startStream(url);
            }
        }, 500);
    </script>
</body>
</html>
