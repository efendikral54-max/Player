<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart TV Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; }
        #video-container, #iframe-container { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        video, iframe { width: 100%; height: 100%; border: none; }
        
        #sound-hint {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 25px 50px;
            border-radius: 20px;
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            z-index: 100;
            transition: opacity 0.6s;
            border: 2px solid #fff;
        }
        .hidden { opacity: 0; pointer-events: none; }
    </style>
</head>
<body>

    <div id="sound-hint">Ses için ⬆️yukarı veya ⬇️aşağı tuşuna basın</div>
    
    <div id="player-target"></div>

    <script>
        const hint = document.getElementById('sound-hint');
        const target = document.getElementById('player-target');
        
        // Holt den Link aus Kodular (global Test)
        let streamUrl = "";
        if (window.AppInventor) {
            streamUrl = window.AppInventor.getWebViewString();
        }

        function initPlayer() {
            if (!streamUrl) {
                // Falls noch leer, kurz warten und erneut versuchen
                setTimeout(() => {
                    streamUrl = window.AppInventor.getWebViewString();
                    if(streamUrl) initPlayer();
                }, 500);
                return;
            }

            // Prüfen ob es ein direkter Stream (.m3u8 / .mp4) oder eine Webseite ist
            if (streamUrl.includes(".m3u8") || streamUrl.includes(".mp4") || streamUrl.includes("/master")) {
                loadDirectVideo(streamUrl);
            } else {
                loadIframeVideo(streamUrl);
            }
        }

        function loadDirectVideo(url) {
            target.innerHTML = '<video id="video" muted autoplay playsinline></video>';
            const video = document.getElementById('video');
            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            } else {
                video.src = url;
                video.play();
            }
            setupRemoteControls(video, true);
        }

        function loadIframeVideo(url) {
            // Browser-Modus für Vidmody & Co
            target.innerHTML = `<iframe id="video-frame" src="${url}" allow="autoplay; fullscreen"></iframe>`;
            setupRemoteControls(null, false);
        }

        function setupRemoteControls(videoElement, isDirect) {
            window.addEventListener('keydown', (event) => {
                // Sound-Hinweis ausblenden und Ton an (Up/Down)
                if (event.keyCode === 38 || event.keyCode === 40) {
                    hint.classList.add('hidden');
                    if (isDirect && videoElement) {
                        videoElement.muted = false;
                        if (event.keyCode === 38) videoElement.volume = Math.min(1, videoElement.volume + 0.1);
                        if (event.keyCode === 40) videoElement.volume = Math.max(0, videoElement.volume - 0.1);
                    }
                }

                // NUR für direkte Videodateien (m3u8) funktionieren OK/Links/Rechts
                if (isDirect && videoElement) {
                    if (event.keyCode === 13) { // OK
                        videoElement.paused ? videoElement.play() : videoElement.pause();
                    }
                    if (event.keyCode === 39) videoElement.currentTime += 10; // Rechts
                    if (event.keyCode === 37) videoElement.currentTime -= 10; // Links
                }
            });
        }

        window.onload = initPlayer;
    </script>
</body>
</html>
