<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Basit Hls.js Oynatıcı</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        /* Macht den Player unsichtbar im Hintergrund und nutzt den ganzen Platz */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #000; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: contain; }
    </style>
</head>
<body>

    <video id="video" autoplay></video>

    <script>
        var video = document.getElementById('video');
        var hls = null;
        var sonUrl = ""; // Merkt sich den letzten Link

        function oynat(yeniUrl) {
            // Wenn schon ein Stream lief, stoppen wir ihn sauber
            if (hls) {
                hls.destroy();
            }

            if (Hls.isSupported()) {
                hls = new Hls();
                hls.loadSource(yeniUrl);
                hls.attachMedia(video);
                
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    video.play(); 
                });
            } 
            else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = yeniUrl;
                video.play();
            }
        }

        // Das ist die Schleife, die auf Kodular wartet
        setInterval(function() {
            var kodularUrl = window.AppInventor.getWebViewString();
            
            // Wenn ein Link da ist und er neu ist -> Starten!
            if (kodularUrl && kodularUrl !== sonUrl) {
                sonUrl = kodularUrl;
                oynat(kodularUrl);
            }
        }, 500);

        // WICHTIG: Sobald du mit der Fernbedienung klickst oder OK drückst,
        // wird der Ton sofort erzwungen.
        window.addEventListener('click', function() {
            video.muted = false;
            video.play();
        });
        window.addEventListener('keydown', function() {
            video.muted = false;
            video.play();
        });

    </script>

</body>
</html>
