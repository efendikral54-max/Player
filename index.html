<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<style>
  body { margin: 0; background: #000; overflow: hidden; height: 100vh; }
  video { width: 100%; height: 100vh; object-fit: contain; }
</style>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>

<video id="video" playsinline></video>

<script>
  var video = document.getElementById('video');
  var hls = null;
  var sonUrl = "";

  // FUNKTION: Versucht mit aller Macht abzuspielen und Lautst채rke zu erzwingen
  function startPowerPlay() {
    video.muted = false; // Wir wollen Ton!
    video.volume = 1.0;

    var promise = video.play();
    if (promise !== undefined) {
      promise.catch(error => {
        // Falls Android blockt: Starte erst stumm (Bild kommt)
        video.muted = true;
        video.play();
      });
    }
  }

  // WACHHUND: L채uft alle 500ms
  setInterval(function() {
    // 1. Wenn das Video pausiert ist -> Play!
    if (video.paused && sonUrl !== "") {
      startPowerPlay();
    }
    // 2. Wenn das Video stumm ist -> Ton an! (Versuch)
    if (video.muted && sonUrl !== "") {
      video.muted = false;
    }
  }, 500);

  // EVENT: Falls das Video stoppt, sofort wieder starten
  video.addEventListener('pause', startPowerPlay);
  video.addEventListener('ended', startPowerPlay);

  function loadStream(url) {
    if (!url) return;
    if (hls) hls.destroy();

    if (Hls.isSupported()) {
      hls = new Hls();
      hls.loadSource(url);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, startPowerPlay);
    } else {
      video.src = url;
      startPowerPlay();
    }
  }

  // Kodular Verbindung
  setInterval(function() {
    var link = window.AppInventor.getWebViewString();
    if (link && link !== sonUrl) {
      sonUrl = link;
      loadStream(link);
    }
  }, 500);

  // Einmalige Freischaltung f체r die gesamte Sitzung
  // Sobald du EINE Taste dr체ckst, darf die App danach ALLES (auch Ton)
  document.addEventListener('keydown', function() {
    video.muted = false;
    video.play();
  });
</script>
</body>
</html>
